<!doctype html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Tic-Tac-Toe WebAssembly</title>
    <link href="tic-tac-toe.css" rel="stylesheet" type="text/css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/multiple.js/0.0.1/multiple.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/multiple.js/0.0.1/multiple.min.js"></script>
    <!--lien vers l'affichage du Download et spinner-->
</head>


<body>
    <div class="container">
        <section class="board">
            <h1>Tic-Tac-Toe Game</h1>
            <div id="tictactoe"></div>
            <div id="player" align="center">
                <span id="turn" align="">Player X</span>
            </div>

            <div id="hidden" align="center" style="visibility:hidden">
                <button class="button" id="playAgain">Play again</button>
            </div>
        </section>
        <footer class="down" style="margin-top: 15px;">
            <div class="container" align="center">
                <p id="Copyright">Réalisé en WebAssembly <br />©2019-2020<br />Version 2.0</p>
            </div>
        </footer>
    </div>

  


    <textarea class="terminal" id="output" rows="6"></textarea>

    <!--JavaScript-->
    <script src="tic-tac-toe.js"></script>
    <script type='text/javascript'>
        var multiple = new Multiple({
            selector: ['.cell', '.terminal'],
            background: 'linear-gradient(to right, #03001e, #7303c0);'

        });

        function runbefore()
        {
            console.log("before module load");
        }

        function runafter()
        {
            init();
            multiple.update();
            console.log("after module load");
        }

        /*Interface that the Emscripten-generated JavaScript glue code uses to interact with our WebAssembly module*/
        var Module = {
            //arrays of functions that will be run before and after the module is loaded
            preRun: [runbefore, initWrappers],
            postRun: [runafter],

            //fct to print out the output of the printf
            print: (function ()
            {
                var element = document.getElementById('output');
                if (element) element.value = ''; // clear browser cache
                return function (text)
                {
                    if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                    /*
                    // The printf statement in C is currently writing to a textarea.  If we wanted to instead
                    // write to an HTML tag, we would need to run these lines of codes to make our text HTML safe
                    text = text.replace(/&/g, "&amp;");
                    text = text.replace(/</g, "&lt;");
                    text = text.replace(/>/g, "&gt;");
                    text = text.replace('\n', '<br>', 'g');
                    */
                    console.log(text);
                    if (element)
                    {
                        element.value += text + "\n";
                        element.scrollTop = element.scrollHeight; // focus on bottom
                    }

                };
            })(),

            //fct run by the glue code when an error or warning occurs
            printErr: function (text)
            {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                if (0)
                { // XXX disabled for safety typeof dump == 'function') {
                    dump(text + '\n'); // fast, straight to the real console
                } else
                {
                    console.error(text);
                }
            },


            setStatus: function (text)
            {
                if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
                if (text === Module.setStatus.last.text) return;
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                var now = Date.now();
                if (m && now - Module.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon
                Module.setStatus.last.time = now;
                Module.setStatus.last.text = text;
                if (m)
                {
                    text = m[1];
                }
                console.log("status: " + text);
            },
            totalDependencies: 0,
            monitorRunDependencies: function (left)
            {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        };
        Module.setStatus('Downloading...');
        window.onerror = function ()
        {
            Module.setStatus('Exception thrown, see JavaScript console');
            Module.setStatus = function (text)
            {
                if (text) Module.printErr('[post-exception status] ' + text);
            };
        };

    </script>
    <script src="main.js"></script>
    <script src="tic-tac-toe.js"></script>
</body>

</html>